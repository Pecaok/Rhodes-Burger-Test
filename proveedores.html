<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Proveedores ‚Ä¢ Rhodes Burgers</title>
  <link rel="icon" href="images/logo.png" />
  <style>
    :root{
      --primary:#625A45; --text:#111; --muted:#666; --bg:#f6f6f6; --card:#fff;
      --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.08); --ring:#eaeaea;
      --danger:#d32f2f; --warn:#ff9800; --success:#2e7d32;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif}
    
    /* HEADER */
    header{position:sticky; top:0; z-index:100; background:#fff; box-shadow:0 2px 12px rgba(0,0,0,.06)}
    .topbar{width: 100%; padding:10px 20px; display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    .brand{display:flex;align-items:center;text-decoration:none;color:inherit;font-weight:700}
    .brand img{width:36px;height:36px;border-radius:10px;background:#fff;object-fit:contain;margin-right:8px}
    .spacer{flex:1}
    
    .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--ring);background:#fff;padding:8px 12px;border-radius:999px;cursor:pointer;font-weight:600;text-decoration:none;color:inherit; transition:all .2s}
    .btn:hover{background:#f4f4f4}
    .btn.primary{background:var(--primary);color:#fff;border-color:var(--primary)}
    .btn.danger{border-color:#ffdddd;background:#fff5f5;color:#b30000}
    .btn.wa{background:#e0f2f1; color:#00695c; border-color:#b2dfdb}
    .btn.wa:hover{background:#b2dfdb}

    /* DROPDOWN */
    .dropdown { position: relative; display: inline-block; }
    .dropdown-content { display: none; position: absolute; background-color: #fff; min-width: 180px; box-shadow: 0 8px 24px rgba(0,0,0,0.12); border-radius: 12px; border: 1px solid var(--ring); z-index: 200; top: 110%; left: 0; overflow: hidden; padding: 4px 0; }
    .dropdown-content a { color: var(--text); padding: 10px 16px; text-decoration: none; display: block; font-size: 14px; font-weight: 500; }
    .dropdown-content a:hover { background-color: #f4f4f4; color: var(--primary); }
    .dropdown:hover .dropdown-content { display: block; }

    /* LAYOUT */
    .container { max-width: 1100px; margin: 24px auto; padding: 0 12px; }
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap; margin-bottom:20px}
    input, select, textarea { padding:12px; border:1px solid var(--ring); border-radius:12px; width:100%; outline:none; font-family:inherit; background:#fff }
    input:focus { border-color:var(--primary) }

    /* GRID DE TARJETAS */
    .prov-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap:20px }
    .prov-card { background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:20px; border:1px solid transparent; transition:transform .2s }
    .prov-card:hover { transform:translateY(-3px); border-color:var(--primary) }
    
    .pc-head { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:10px }
    .pc-name { font-size:18px; font-weight:800; color:#222 }
    .pc-badge { font-size:11px; font-weight:700; text-transform:uppercase; padding:4px 8px; background:#f0f0f0; border-radius:6px; color:#555 }
    .pc-info { display:flex; flex-direction:column; gap:6px; font-size:14px; color:#555 }
    .pc-note { font-size:13px; color:#888; font-style:italic; margin-top:10px; background:#fafafa; padding:8px; border-radius:8px }
    
    .pc-actions { margin-top:15px; display:flex; gap:10px }

    /* MODAL */
    .modal-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.4); display:none; justify-content:center; align-items:center; z-index:900; backdrop-filter:blur(2px) }
    .modal { background:#fff; width:90%; max-width:450px; padding:25px; border-radius:20px; box-shadow:0 20px 50px rgba(0,0,0,0.2) }
    .form-group { margin-bottom:15px }
    .form-group label { display:block; margin-bottom:6px; font-weight:600; font-size:13px; color:var(--muted) }
  </style>
</head>
<body>
  <script>
    (function(){
      const ok = localStorage.getItem('rb_admin_ok')==='true';
      if(!ok) location.replace('login.html');
    })();
  </script>

  <header>
    <div class="topbar">
      <a class="brand" href="#"><img src="images/logo.png" alt="RB">Proveedores</a>
      <div class="spacer"></div>
      <nav style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">
        <a href="pedido_local.html" class="btn">üì¶ Pedidos</a>
        <a href="finanzas.html" class="btn">üìà Finanzas</a>
        <div class="dropdown">
            <button class="btn primary">üìã Stock ‚ñæ</button>
            <div class="dropdown-content">
                <a href="stock.html">üì¶ Ver Stock Actual</a>
                <a href="ingresos.html">üì• Ingreso Mercader√≠a</a>
                <a href="proveedores.html">üöö Proveedores</a>
            </div>
        </div>
        <a href="mostrador.html" class="btn">üßæ Mostrador</a>
      </nav>
      <button onclick="localStorage.removeItem('rb_admin_ok');location.reload()" class="btn danger" style="margin-left:8px">Salir</button>
    </div>
  </header>

  <main class="container">
    <div class="row">
        <h1>Directorio de Proveedores</h1>
        <button id="btnNew" class="btn primary">Ôºã Agregar Proveedor</button>
    </div>

    <div style="margin-bottom:20px">
        <input type="text" id="searchBox" placeholder="üîç Buscar por nombre o rubro (ej: Carnicero, Coca Cola...)" />
    </div>

    <div id="grid" class="prov-grid">
        <div style="grid-column:1/-1; text-align:center; color:#999; padding:40px">Cargando agenda...</div>
    </div>
  </main>

  <div class="modal-overlay" id="modal">
    <div class="modal">
        <h2 id="modalTitle" style="margin-top:0">Nuevo Proveedor</h2>
        <input type="hidden" id="editId">
        
        <div class="form-group">
            <label>Nombre / Empresa</label>
            <input type="text" id="pName" placeholder="Ej: Av√≠cola San Andr√©s">
        </div>
        
        <div class="form-group">
            <label>Rubro</label>
            <input type="text" id="pCategory" placeholder="Ej: Pollo, Pan, Limpieza...">
        </div>

        <div class="form-group">
            <label>Tel√©fono (WhatsApp)</label>
            <input type="tel" id="pPhone" placeholder="Ej: 11 1234 5678">
            <small style="color:#999">Solo n√∫meros para que funcione el link directo.</small>
        </div>

        <div class="form-group">
            <label>Notas / D√≠as de entrega</label>
            <textarea id="pNotes" rows="3" placeholder="Ej: Pide los lunes antes de las 10am."></textarea>
        </div>

        <div style="display:flex; gap:10px; margin-top:20px">
            <button id="btnSave" class="btn primary" style="flex:1">Guardar</button>
            <button id="btnClose" class="btn" style="flex:1">Cancelar</button>
        </div>
        <button id="btnDelete" class="btn danger" style="width:100%; margin-top:10px; display:none">Eliminar</button>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBbt5YOWDE0ouLn-Ib_iD1yUesok5SEhB8",
      authDomain: "rhodes-burguers.firebaseapp.com",
      projectId: "rhodes-burguers",
      storageBucket: "rhodes-burguers.firebasestorage.app",
      messagingSenderId: "951646688091",
      appId: "1:951646688091:web:05db5fadb4150d1fa9c07e"
    };
    try { firebase.initializeApp(firebaseConfig); } catch(e) {}
    const db = firebase.firestore();
    const $ = s => document.querySelector(s);
    let PROVIDERS = [];

    function init(){
        db.collection('providers').orderBy('name').onSnapshot(snap => {
            PROVIDERS = snap.docs.map(d => ({id:d.id, ...d.data()}));
            render();
        });

        $('#searchBox').addEventListener('input', render);
        $('#btnNew').onclick = () => openModal();
        $('#btnClose').onclick = closeModal;
        $('#btnSave').onclick = saveProvider;
        $('#btnDelete').onclick = deleteProvider;
    }

    function render(){
        const term = $('#searchBox').value.toLowerCase();
        const grid = $('#grid');
        grid.innerHTML = '';

        const filtered = PROVIDERS.filter(p => 
            p.name.toLowerCase().includes(term) || 
            (p.category||'').toLowerCase().includes(term)
        );

        if(filtered.length === 0){
            grid.innerHTML = `<div style="grid-column:1/-1; text-align:center; color:#999; padding:20px">No se encontraron proveedores.</div>`;
            return;
        }

        filtered.forEach(p => {
            // Limpiar tel√©fono para WhatsApp
            const rawPhone = (p.phone||'').replace(/\D/g,''); 
            const waLink = rawPhone ? `https://wa.me/549${rawPhone}` : '#'; // Asumo Arg (+549), ajustable

            const card = document.createElement('div');
            card.className = 'prov-card';
            card.innerHTML = `
                <div class="pc-head">
                    <div class="pc-name">${p.name}</div>
                    <div class="pc-badge">${p.category || 'Varios'}</div>
                </div>
                <div class="pc-info">
                    <div>üìû ${p.phone || 'Sin tel√©fono'}</div>
                    ${p.notes ? `<div class="pc-note">üìù ${p.notes}</div>` : ''}
                </div>
                <div class="pc-actions">
                    ${rawPhone ? `<a href="${waLink}" target="_blank" class="btn wa" style="flex:1; justify-content:center">üí¨ WhatsApp</a>` : ''}
                    <button class="btn" style="flex:1; justify-content:center" onclick="editProvider('${p.id}')">‚úèÔ∏è Editar</button>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    async function saveProvider(){
        const id = $('#editId').value;
        const data = {
            name: $('#pName').value,
            category: $('#pCategory').value,
            phone: $('#pPhone').value,
            notes: $('#pNotes').value
        };

        if(!data.name) return alert("Falta el nombre");
        $('#btnSave').textContent = "Guardando...";

        try {
            if(id) await db.collection('providers').doc(id).update(data);
            else await db.collection('providers').add(data);
            closeModal();
        } catch(e){ console.error(e); alert("Error al guardar"); }
        $('#btnSave').textContent = "Guardar";
    }

    async function deleteProvider(){
        const id = $('#editId').value;
        if(confirm("¬øBorrar este contacto?")){
            await db.collection('providers').doc(id).delete();
            closeModal();
        }
    }

    function openModal(p = null){
        $('#modal').style.display = 'flex';
        if(p){
            $('#modalTitle').textContent = "Editar Proveedor";
            $('#editId').value = p.id;
            $('#pName').value = p.name;
            $('#pCategory').value = p.category;
            $('#pPhone').value = p.phone;
            $('#pNotes').value = p.notes;
            $('#btnDelete').style.display = 'block';
        } else {
            $('#modalTitle').textContent = "Nuevo Proveedor";
            $('#editId').value = '';
            $('#pName').value = '';
            $('#pCategory').value = '';
            $('#pPhone').value = '';
            $('#pNotes').value = '';
            $('#btnDelete').style.display = 'none';
        }
    }

    function closeModal(){ $('#modal').style.display = 'none'; }
    window.editProvider = (id) => { const p = PROVIDERS.find(x=>x.id===id); if(p) openModal(p); };

    init();
  </script>
</body>
</html>
